<script>
    // PASTE YOUR NEW WEB APP URL HERE
    const GOOGLE_SCRIPT_URL = 'YOUR_NEW_WEB_APP_URL_HERE';

    document.addEventListener('DOMContentLoaded', () => {
        const btn = document.getElementById('submitBtn');
        const form = document.getElementById('diagnosticForm');
        const resultArea = document.getElementById('result-area');
        const phoneInput = document.getElementById('waNumber');
        
        btn.addEventListener('click', () => {
            document.querySelectorAll('.question-card').forEach(c => c.classList.remove('error'));
            phoneInput.style.borderColor = "#333";
            
            let score = 0;
            let answeredCount = 0;
            let firstError = null;
            let answers = {};

            // 1. Validation & Capture
            for (let i = 1; i <= 5; i++) {
                constname = `q${i}`;
                const selected = form.querySelector(`input[name="q${i}"]:checked`);
                const card = document.getElementById(`card-q${i}`);
                
                if (selected) {
                    let val = parseInt(selected.value);
                    score += val;
                    
                    // FIX: Capture the actual text "Yes" or "No"
                    // This finds the <span> next to the radio button
                    let answerText = selected.nextElementSibling.innerText;
                    answers[`q${i}`] = answerText; 
                    
                    answeredCount++;
                } else {
                    card.classList.add('error');
                    if (!firstError) firstError = card;
                }
            }

            if (phoneInput.value.length < 10) {
                if (!firstError) firstError = phoneInput;
                return alert("Valid phone number required.");
            }

            if (answeredCount < 5) {
                if (firstError) firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return; 
            }

            // Logic Interpretation
            let label = "";
            let copy = "";
            if (score <= 1) { 
                label = "System-Led Operations";
                copy = "Your operations are robust. The business functions as a machine.";
            } else if (score <= 3) {
                label = "Owner-Dependent";
                copy = "Decisions bottleneck at you. Structure compensates for lack of system.";
            } else {
                label = "Single Point of Failure";
                copy = "Critically fragile. If you stop, the business stops.";
            }

            // Send to Google Sheets
            btn.textContent = "Processing...";
            btn.disabled = true;

            const payload = {
                type: 'diagnostic', // Identifies this as Customer Data
                phone: phoneInput.value,
                q1: answers.q1,
                q2: answers.q2,
                q3: answers.q3,
                q4: answers.q4,
                q5: answers.q5,
                score: score,
                label: label
            };

            fetch(GOOGLE_SCRIPT_URL, {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            }).then(() => {
                // WA Link Logic
                const waNumber = "8200537903"; 
                const msg = `Hi Afzal,%0A%0AI completed the OpsCraft Diagnostic.%0A*Phone:* ${phoneInput.value}%0A*Score:* ${score}/5%0A*Result:* ${label}`;
                
                document.getElementById('r-title').textContent = label;
                document.getElementById('r-copy').textContent = copy;
                document.getElementById('whatsapp-link').href = `https://wa.me/${waNumber}?text=${msg}`;
                
                resultArea.style.display = "block";
                resultArea.scrollIntoView({ behavior: 'smooth' });
                btn.textContent = "Analysis Complete";
            });
        });
    });
</script>
